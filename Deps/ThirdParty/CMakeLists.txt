# Copyright 2025 Xenon Emulator Project

set(BUILD_SHARED_LIBS OFF)
set(BUILD_TESTING OFF)
set_directory_properties(PROPERTIES EXCLUDE_FROM_ALL ON SYSTEM ON)

# Set CMP0069 policy to "NEW" for building external targets with LTO enabled
set(CMAKE_POLICY_DEFAULT_CMP0069 NEW)

# fmt
if (NOT TARGET fmt::fmt)
  add_subdirectory(fmt)
endif()

# GLAD
add_subdirectory(glad)

# RenderDoc
if (NOT TARGET RenderDoc::API)
    add_library(renderdoc INTERFACE)
    target_include_directories(renderdoc INTERFACE ./renderdoc)
    add_library(RenderDoc::API ALIAS renderdoc)
endif()

# SDL3
if (GFX_ENABLED)
  if (NOT TARGET SDL3::SDL3)
    set(SDL_DISKAUDIO OFF)
    set(SDL_TEST_LIBRARY OFF)
    set(SDL_PIPEWIRE OFF)
    add_subdirectory(SDL3)
  endif()
endif()

# Toml11
if (NOT TARGET toml11::toml11)
  add_subdirectory(toml11)
  set(TOML11_INSTALL OFF)

  # This removes the warnings generated by toml11
  if (CMAKE_CXX_COMPILER_ID STREQUAL "Clang" AND CMAKE_CXX_COMPILER_FRONTEND_VARIANT STREQUAL "MSVC")
    get_target_property(_toml11_compile_options toml11 INTERFACE_COMPILE_OPTIONS)
    list(REMOVE_ITEM _toml11_compile_options "/Zc:preprocessor")
    set_target_properties(toml11 PROPERTIES INTERFACE_COMPILE_OPTIONS ${_toml11_compile_options})
  endif()
endif()
